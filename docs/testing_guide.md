# Testing Guide

## üß™ **–û–±–∑–æ—Ä —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

PyUI Automation –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è UI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –§—Ä–µ–π–º–≤–æ—Ä–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤: unit —Ç–µ—Å—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã, –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## üéØ **–¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤**

### **Unit —Ç–µ—Å—Ç—ã**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
- –ë–ª–∏–∑–æ—Å—Ç—å –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### **–í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å baseline –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ UI –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤

### **–¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU –∏ –ø–∞–º—è—Ç–∏
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üõ†Ô∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

### **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pytest –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
uv add pytest pytest-cov pytest-mock pytest-html

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
uv add pytest-xdist  # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
uv add pytest-repeat  # –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
uv add pytest-timeout  # –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤
```

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞**

```
tests/
‚îú‚îÄ‚îÄ conftest.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ unit/                    # Unit —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_elements.py
‚îÇ   ‚îú‚îÄ‚îÄ test_services.py
‚îÇ   ‚îî‚îÄ‚îÄ test_utils.py
‚îú‚îÄ‚îÄ integration/             # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_automation_flow.py
‚îÇ   ‚îú‚îÄ‚îÄ test_applications.py
‚îÇ   ‚îî‚îÄ‚îÄ test_performance.py
‚îú‚îÄ‚îÄ visual/                  # –í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_ui_consistency.py
‚îÇ   ‚îî‚îÄ‚îÄ baseline/            # Baseline –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ performance/             # –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ test_memory_leaks.py
‚îÇ   ‚îî‚îÄ‚îÄ test_stress.py
‚îî‚îÄ‚îÄ fixtures/                # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    ‚îú‚îÄ‚îÄ test_apps/
    ‚îî‚îÄ‚îÄ test_data/
```

### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest**

```python
# tests/conftest.py
import pytest
from pyui_automation.core import DIAutomationManager
from pyui_automation.core.services.di_container import cleanup

@pytest.fixture(scope="session")
def automation_manager():
    """–ì–ª–æ–±–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤"""
    manager = DIAutomationManager()
    yield manager
    manager.cleanup()

@pytest.fixture(scope="function")
def clean_di_container():
    """–û—á–∏—Å—Ç–∫–∞ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞"""
    yield
    cleanup()

@pytest.fixture(scope="function")
def mock_backend():
    """–ú–æ–∫ backend –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤"""
    from unittest.mock import Mock
    backend = Mock()
    backend.find_element_by_object_name.return_value = Mock()
    backend.capture_screenshot.return_value = Mock()
    return backend

@pytest.fixture(scope="function")
def automation_session(mock_backend):
    """–°–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å –º–æ–∫ backend"""
    from pyui_automation.core import AutomationSession
    return AutomationSession(mock_backend)
```

## üß™ **Unit —Ç–µ—Å—Ç—ã**

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤**

```python
# tests/unit/test_elements.py
import pytest
from unittest.mock import Mock, patch
from pyui_automation.elements import BaseElement

class TestBaseElement:
    
    def test_element_click(self, mock_backend):
        """–¢–µ—Å—Ç –∫–ª–∏–∫–∞ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É"""
        # Arrange
        native_element = Mock()
        session = Mock()
        element = BaseElement(native_element, session)
        
        # Act
        element.click()
        
        # Assert
        native_element.click.assert_called_once()
    
    def test_element_type_text(self, mock_backend):
        """–¢–µ—Å—Ç –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –≤ —ç–ª–µ–º–µ–Ω—Ç"""
        # Arrange
        native_element = Mock()
        session = Mock()
        element = BaseElement(native_element, session)
        text = "Hello, World!"
        
        # Act
        element.type_text(text)
        
        # Assert
        native_element.send_keys.assert_called_once_with(text)
    
    def test_element_get_text(self, mock_backend):
        """–¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–∞"""
        # Arrange
        native_element = Mock()
        native_element.text = "Test Text"
        session = Mock()
        element = BaseElement(native_element, session)
        
        # Act
        result = element.get_text()
        
        # Assert
        assert result == "Test Text"
    
    def test_element_is_enabled(self, mock_backend):
        """–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç–∞"""
        # Arrange
        native_element = Mock()
        native_element.is_enabled.return_value = True
        session = Mock()
        element = BaseElement(native_element, session)
        
        # Act
        result = element.is_enabled()
        
        # Assert
        assert result is True
        native_element.is_enabled.assert_called_once()
```

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤**

```python
# tests/unit/test_services.py
import pytest
from unittest.mock import Mock, patch
from pyui_automation.core.services.performance_monitor import PerformanceMonitor

class TestPerformanceMonitor:
    
    def test_start_monitoring(self):
        """–¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        # Arrange
        application = Mock()
        monitor = PerformanceMonitor(application)
        
        # Act
        monitor.start_monitoring(interval=1.0)
        
        # Assert
        assert monitor.is_monitoring is True
        assert monitor.metrics == []
    
    def test_stop_monitoring(self):
        """–¢–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        # Arrange
        application = Mock()
        monitor = PerformanceMonitor(application)
        monitor.start_monitoring()
        
        # Act
        metrics = monitor.stop_monitoring()
        
        # Assert
        assert monitor.is_monitoring is False
        assert isinstance(metrics, list)
    
    def test_record_metric(self):
        """–¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –º–µ—Ç—Ä–∏–∫–∏"""
        # Arrange
        application = Mock()
        monitor = PerformanceMonitor(application)
        
        # Act
        monitor.record_metric(response_time=0.5)
        
        # Assert
        assert len(monitor.metrics) == 1
        assert monitor.metrics[0].response_time == 0.5
    
    @patch('time.time')
    def test_get_average_metrics(self, mock_time):
        """–¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–∏—Ö –º–µ—Ç—Ä–∏–∫"""
        # Arrange
        mock_time.return_value = 100.0
        application = Mock()
        monitor = PerformanceMonitor(application)
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
        monitor.record_metric(response_time=1.0)
        monitor.record_metric(response_time=2.0)
        monitor.record_metric(response_time=3.0)
        
        # Act
        avg_metrics = monitor.get_average_metrics()
        
        # Assert
        assert avg_metrics['response_time'] == 2.0
        assert avg_metrics['duration'] == 0.0
```

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å DI**

```python
# tests/unit/test_di.py
import pytest
from unittest.mock import Mock
from pyui_automation.core.services.di_container import register_service, get_service, cleanup

class TestDependencyInjection:
    
    def setup_method(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º"""
        cleanup()
    
    def test_service_registration(self):
        """–¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞"""
        # Arrange
        mock_service = Mock()
        
        # Act
        register_service('test_service', lambda: mock_service, singleton=True)
        service = get_service('test_service')
        
        # Assert
        assert service is mock_service
    
    def test_singleton_behavior(self):
        """–¢–µ—Å—Ç –ø–æ–≤–µ–¥–µ–Ω–∏—è singleton —Å–µ—Ä–≤–∏—Å–æ–≤"""
        # Arrange
        mock_service = Mock()
        register_service('singleton_service', lambda: mock_service, singleton=True)
        
        # Act
        service1 = get_service('singleton_service')
        service2 = get_service('singleton_service')
        
        # Assert
        assert service1 is service2
    
    def test_transient_behavior(self):
        """–¢–µ—Å—Ç –ø–æ–≤–µ–¥–µ–Ω–∏—è transient —Å–µ—Ä–≤–∏—Å–æ–≤"""
        # Arrange
        def create_service():
            return Mock()
        
        register_service('transient_service', create_service, singleton=False)
        
        # Act
        service1 = get_service('transient_service')
        service2 = get_service('transient_service')
        
        # Assert
        assert service1 is not service2
    
    def test_configuration_management(self):
        """–¢–µ—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π"""
        from pyui_automation.core.services.di_container import set_config, get_config
        
        # Act
        set_config('test_key', 'test_value')
        value = get_config('test_key')
        
        # Assert
        assert value == 'test_value'
    
    def teardown_method(self):
        """–û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞"""
        cleanup()
```

## üîó **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏**

```python
# tests/integration/test_automation_flow.py
import pytest
from pyui_automation.core import DIAutomationManager, AutomationSession
from pyui_automation.core.factory import BackendFactory

class TestAutomationFlow:
    
    def test_create_session(self, automation_manager):
        """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏"""
        # Act
        session = automation_manager.create_session()
        
        # Assert
        assert session is not None
        assert session.backend is not None
        assert session.locator is not None
        assert session.session_id is not None
    
    def test_backend_creation(self, automation_manager):
        """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è backend –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º"""
        # Arrange
        platforms = ['windows', 'linux', 'macos']
        
        for platform in platforms:
            # Act
            backend = automation_manager.create_backend(platform)
            
            # Assert
            assert backend is not None
            assert hasattr(backend, 'find_element_by_object_name')
            assert hasattr(backend, 'capture_screenshot')
    
    def test_element_finding_flow(self, automation_manager):
        """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤"""
        # Arrange
        session = automation_manager.create_session()
        
        # Act & Assert
        # –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ø–æ objectName
        try:
            element = session.find_element_by_object_name("test_element")
            # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞
            if element:
                assert element.native_element is not None
        except Exception:
            # –≠–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ
            pass
    
    def test_screenshot_capture(self, automation_manager):
        """–¢–µ—Å—Ç –∑–∞—Ö–≤–∞—Ç–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞"""
        # Arrange
        session = automation_manager.create_session()
        
        # Act
        screenshot = session.capture_screenshot()
        
        # Assert
        assert screenshot is not None
        assert hasattr(screenshot, 'shape')  # numpy array
        assert len(screenshot.shape) == 3  # RGB image
    
    def test_performance_monitoring_integration(self, automation_manager):
        """–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        # Arrange
        session = automation_manager.create_session()
        
        # Act
        session.start_performance_monitoring(interval=0.1)
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
        for i in range(5):
            session.capture_screenshot()
        
        metrics = session.stop_performance_monitoring()
        
        # Assert
        assert metrics is not None
        assert len(metrics) > 0
        assert 'avg_cpu_usage' in metrics
        assert 'avg_memory_usage' in metrics
```

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**

```python
# tests/integration/test_applications.py
import pytest
from pyui_automation.application import Application
import time

class TestApplications:
    
    def test_application_launch(self):
        """–¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
        # Arrange
        app_path = "notepad.exe"  # –ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        
        # Act
        try:
            app = Application.launch(app_path)
            
            # Assert
            assert app is not None
            assert app.process is not None
            assert app.is_running() is True
            
            # Cleanup
            app.terminate()
            time.sleep(1)
            
        except Exception as e:
            # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ
            pytest.skip(f"Application {app_path} not available: {e}")
    
    def test_application_attach(self):
        """–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É"""
        # Arrange
        app_path = "notepad.exe"
        
        try:
            app = Application.launch(app_path)
            pid = app.pid
            
            # Act
            attached_app = Application.attach(pid)
            
            # Assert
            assert attached_app is not None
            assert attached_app.pid == pid
            assert attached_app.is_running() is True
            
            # Cleanup
            app.terminate()
            time.sleep(1)
            
        except Exception as e:
            pytest.skip(f"Application not available: {e}")
    
    def test_application_termination(self):
        """–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
        # Arrange
        app_path = "notepad.exe"
        
        try:
            app = Application.launch(app_path)
            
            # Act
            app.terminate()
            time.sleep(1)
            
            # Assert
            assert app.is_running() is False
            
        except Exception as e:
            pytest.skip(f"Application not available: {e}")
```

## üëÅÔ∏è **–í–∏–∑—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UI –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏**

```python
# tests/visual/test_ui_consistency.py
import pytest
import os
from pathlib import Path
from pyui_automation.core import DIAutomationManager, AutomationSession

class TestVisualConsistency:
    
    @pytest.fixture(scope="class")
    def baseline_dir(self):
        """–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è baseline –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"""
        baseline_path = Path("tests/visual/baseline")
        baseline_path.mkdir(parents=True, exist_ok=True)
        return baseline_path
    
    @pytest.fixture(scope="class")
    def session(self, automation_manager):
        """–°–µ—Å—Å–∏—è –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
        return automation_manager.create_session()
    
    def test_capture_baseline(self, session, baseline_dir):
        """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è baseline –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
        # Arrange
        session.init_visual_testing(str(baseline_dir))
        
        # Act
        success = session.capture_visual_baseline("main_window")
        
        # Assert
        assert success is True
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
        baseline_file = baseline_dir / "main_window.png"
        assert baseline_file.exists()
    
    def test_visual_comparison(self, session, baseline_dir):
        """–¢–µ—Å—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è"""
        # Arrange
        session.init_visual_testing(str(baseline_dir))
        
        # –°–æ–∑–¥–∞–µ–º baseline –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
        if not (baseline_dir / "main_window.png").exists():
            session.capture_visual_baseline("main_window")
        
        # Act
        result = session.compare_visual("main_window")
        
        # Assert
        assert result is not None
        assert "match" in result
        assert "similarity" in result
        assert isinstance(result["similarity"], float)
        assert 0.0 <= result["similarity"] <= 1.0
    
    def test_visual_regression_detection(self, session, baseline_dir):
        """–¢–µ—Å—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Ä–µ–≥—Ä–µ—Å—Å–∏–π"""
        # Arrange
        session.init_visual_testing(str(baseline_dir), threshold=0.95)
        
        # –°–æ–∑–¥–∞–µ–º baseline
        session.capture_visual_baseline("test_element")
        
        # Act
        result = session.compare_visual("test_element")
        
        # Assert
        if result["match"]:
            assert result["similarity"] >= 0.95
        else:
            # –ï—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ –ø—Ä–æ—à–µ–ª, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç
            session.generate_visual_report("test_element", result["differences"], "reports/")
            assert result["similarity"] < 0.95
    
    def test_element_screenshot(self, session, baseline_dir):
        """–¢–µ—Å—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞"""
        # Arrange
        session.init_visual_testing(str(baseline_dir))
        
        # Act
        try:
            # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∏ —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ —Å–∫—Ä–∏–Ω—à–æ—Ç
            element = session.find_element_by_object_name("test_element")
            if element:
                screenshot = session.capture_element_screenshot(element)
                
                # Assert
                assert screenshot is not None
                assert hasattr(screenshot, 'shape')
                assert len(screenshot.shape) == 3
        except Exception:
            # –≠–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
            pass
```

## üìä **–¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏**

```python
# tests/performance/test_memory_leaks.py
import pytest
import gc
import psutil
from pyui_automation.core import DIAutomationManager

class TestMemoryLeaks:
    
    def test_memory_leak_detection(self, automation_manager):
        """–¢–µ—Å—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏"""
        # Arrange
        session = automation_manager.create_session()
        
        # Act
        leak_report = session.check_memory_leaks(iterations=10)
        
        # Assert
        assert leak_report is not None
        assert "memory_growth" in leak_report
        assert "leak_detected" in leak_report
        assert isinstance(leak_report["leak_detected"], bool)
    
    def test_stress_test(self, automation_manager):
        """–°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏"""
        # Arrange
        session = automation_manager.create_session()
        
        def stress_action():
            """–î–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∞"""
            session.capture_screenshot()
            # –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            try:
                session.find_element_by_object_name("test_element")
            except:
                pass
        
        # Act
        stress_report = session.run_stress_test(stress_action, duration=5.0)
        
        # Assert
        assert stress_report is not None
        assert "total_time" in stress_report
        assert "iterations" in stress_report
        assert "success_rate" in stress_report
        assert stress_report["iterations"] > 0
        assert 0.0 <= stress_report["success_rate"] <= 1.0
    
    def test_performance_metrics_collection(self, automation_manager):
        """–¢–µ—Å—Ç —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        # Arrange
        session = automation_manager.create_session()
        
        # Act
        session.start_performance_monitoring(interval=0.1)
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏—è
        for i in range(10):
            session.capture_screenshot()
        
        metrics = session.stop_performance_monitoring()
        
        # Assert
        assert metrics is not None
        assert len(metrics) > 0
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–µ—Ç—Ä–∏–∫
        for metric in metrics:
            assert hasattr(metric, 'timestamp')
            assert hasattr(metric, 'cpu_usage')
            assert hasattr(metric, 'memory_usage')
            assert hasattr(metric, 'response_time')
    
    def test_performance_regression_detection(self, automation_manager):
        """–¢–µ—Å—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        # Arrange
        session = automation_manager.create_session()
        
        def test_action():
            """–¢–µ—Å—Ç–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ"""
            session.capture_screenshot()
        
        # Baseline –º–µ—Ç—Ä–∏–∫–∏ (–∏–º–∏—Ç–∏—Ä—É–µ–º)
        baseline_metrics = {
            'response_time': {'avg': 0.1, 'std': 0.02},
            'memory_usage': {'avg': 100.0, 'std': 10.0},
            'cpu_usage': {'avg': 5.0, 'std': 1.0}
        }
        
        # Act
        regression_report = session.performance_tester.detect_regression(
            test_action, baseline_metrics, test_runs=3
        )
        
        # Assert
        assert regression_report is not None
        assert "regression_detected" in regression_report
        assert "current_metrics" in regression_report
        assert "baseline_metrics" in regression_report
```

## üéØ **Best Practices**

### **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤**
1. **–†–∞–∑–¥–µ–ª—è–π—Ç–µ —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤** - unit, integration, visual, performance
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã** –¥–ª—è –æ–±—â–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. **–û—á–∏—â–∞–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã** –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤
4. **–ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** –≤ –∫–ª–∞—Å—Å—ã

### **–ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ**
1. **–ú–æ–∫–∏—Ä—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –≤ unit —Ç–µ—Å—Ç–∞—Ö
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã** –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
3. **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –º–æ–∫–∏** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤—ã–∑–æ–≤—ã –º–æ–∫–æ–≤** –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

### **–í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
1. **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ baseline** –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–æ—Ä–æ–≥–∏** —Å—Ö–æ–¥—Å—Ç–≤–∞
3. **–ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –æ—Ç—á–µ—Ç—ã** –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
4. **–û–±–Ω–æ–≤–ª—è–π—Ç–µ baseline** –ø—Ä–∏ –Ω–∞–º–µ—Ä–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
1. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏** –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
2. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ**
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã** –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–æ–≤
4. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç—Ä–µ–Ω–¥—ã** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏**
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
2. **–û—á–∏—â–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ** –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ** –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

## üöÄ **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤**

### **–ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã**

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
uv run pytest

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
uv run pytest -v

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
uv run pytest --cov=pyui_automation --cov-report=html

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
uv run pytest tests/unit/test_elements.py::TestBaseElement::test_element_click

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º
uv run pytest -m "unit"
uv run pytest -m "integration"
uv run pytest -m "visual"
uv run pytest -m "performance"
```

### **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ –ø–∞—Ä–∞–ª–ª–µ–ª–∏
uv run pytest -n auto

# –ó–∞–ø—É—Å–∫ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
uv run pytest -n 4
```

### **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤**

```bash
# HTML –æ—Ç—á–µ—Ç
uv run pytest --html=reports/test_report.html

# JUnit XML –æ—Ç—á–µ—Ç
uv run pytest --junitxml=reports/junit.xml

# Coverage –æ—Ç—á–µ—Ç
uv run pytest --cov=pyui_automation --cov-report=html --cov-report=term
```

### **CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**

```yaml
# .github/workflows/test.yml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.12'
      - run: |
          pip install uv
          uv sync
          uv run pytest --cov=pyui_automation --cov-report=xml
      - uses: codecov/codecov-action@v2
        with:
          file: ./coverage.xml
```

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ UI —Å –ø–æ–º–æ—â—å—é PyUI Automation. 