<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Панель результатов тестирования Windsurf">
    <meta name="theme-color" content="#2196F3">
    <title>Test Results Dashboard</title>
    
    <!-- Прелоадеры для критических ресурсов -->
    <link rel="preload" href="assets/css/live-update.css?v=1.0.0" as="style">
    <link rel="preload" href="assets/js/live-update.js?v=1.0.0" as="script">
    
    <!-- Основные стили -->
    <link rel="stylesheet" href="assets/css/live-update.css?v=1.0.0">
    
    <!-- Манифест для PWA -->
    <link rel="manifest" href="assets/manifest.json">
    <link rel="icon" type="image/png" href="assets/icons/favicon-32x32.png" sizes="32x32">
    
    <!-- Встроенные критические стили -->
    <style>
        .loading { 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: var(--color-bg, #fff);
        }
        .loading::after {
            content: "";
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden { display: none !important; }
    </style>
    
    <!-- Основной скрипт -->
    <script src="assets/js/live-update.js?v=1.0.0"></script>
</head>
<body class="loading">
    <div id="app" class="hidden">
        <div class="header">
            <h1>Test Report</h1>
            <div class="connection-status">
                <span id="connection-status">Подключение...</span>
            </div>
        </div>

        <div class="test-results">
            <div class="controls">
                <input type="text" id="search" placeholder="Поиск тестов..." aria-label="Поиск тестов">
                <select id="status-filter" aria-label="Фильтр по статусу">
                    <option value="all">Все статусы</option>
                    <option value="passed">Успешные</option>
                    <option value="failed">Неудачные</option>
                    <option value="skipped">Пропущенные</option>
                </select>
                <button id="expand-all" aria-label="Развернуть все">Развернуть все</button>
                <button id="collapse-all" aria-label="Свернуть все">Свернуть все</button>
                <button class="summary__reload__button" id="reload" aria-label="Обновить результаты">
                    <span class="reload-icon">↻</span> Обновить
                </button>
            </div>

            <div id="filter-summary" aria-live="polite">
                Показано: <span id="shown-tests">0</span> из <span id="total-tests">0</span> тестов
            </div>

            <div class="counters" role="region" aria-label="Статистика тестов">
                <div class="counter passed">
                    <div class="label">Успешные</div>
                    <div id="passed-count" aria-live="polite">0</div>
                </div>
                <div class="counter failed">
                    <div class="label">Неудачные</div>
                    <div id="failed-count" aria-live="polite">0</div>
                </div>
                <div class="counter skipped">
                    <div class="label">Пропущенные</div>
                    <div id="skipped-count" aria-live="polite">0</div>
                </div>
                <div class="counter total">
                    <div class="label">Всего</div>
                    <div id="total-count" aria-live="polite">0</div>
                </div>
            </div>

            <div id="test-results" class="test-container" role="main">
                <!-- Сюда будут динамически добавляться результаты тестов -->
            </div>

            <div class="test-details" style="display: none;">
                <div class="test-description"></div>
                <div class="test-logs"></div>
                <div class="test-output">
                    <div class="stdout"></div>
                    <div class="stderr"></div>
                </div>
                <div class="test-metadata">
                    <span class="timestamp"></span>
                    <span class="duration"></span>
                </div>
            </div>

            <div id="notification" class="notification hidden" role="alert" aria-live="polite">
                <span class="notification-message"></span>
                <button class="notification-close" aria-label="Закрыть уведомление">&times;</button>
            </div>

            <div class="status-bar" role="status" aria-live="polite">
                <div class="status-indicator">
                    <span class="status-icon"></span>
                    <span class="status-text">Не подключено</span>
                </div>
                <div class="test-progress hidden">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <span class="progress-text">0/0 тестов</span>
                </div>
                <div class="last-update">
                    Последнее обновление: никогда
                </div>
            </div>
        </div>

        <footer>
            <p>Powered by Windsurf Test Runner v1.0.0</p>
        </footer>
    </div>

    <!-- Инициализация приложения -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Показываем приложение после загрузки
            document.body.classList.remove('loading');
            document.getElementById('app').classList.remove('hidden');
            
            // Инициализируем клиент обновлений
            window.testResults = new LiveUpdateClient();
        });
        
        // Регистрация Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/assets/js/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker зарегистрирован:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Ошибка регистрации ServiceWorker:', error);
                    });
            });
        }
    </script>
</body>
</html>